# Test Verification Checklist

## Pre-Run Verification

Before running the tests for the first time, verify:

### ✅ File Structure
```bash
ls -lh src/__tests__/security/
```

Expected files:
- `attack-vectors.test.ts` (28 KB) - Main test suite
- `README.md` (11 KB) - Comprehensive documentation
- `QUICK_START.md` (4.3 KB) - Quick reference
- `TEST_SUMMARY.md` (6.5 KB) - Overview and statistics
- `github-actions-example.yml` (3.9 KB) - CI/CD template

### ✅ Dependencies Installed
```bash
npm list jest ts-jest @types/jest
```

Expected output:
```
claude-orchestrator@1.0.0
├── @types/jest@30.0.0
├── jest@30.2.0
└── ts-jest@29.4.6
```

If missing, install:
```bash
npm install
```

### ✅ TypeScript Configuration
```bash
cat tsconfig.json | grep -E "esModuleInterop|types"
```

Expected:
```json
"types": ["node", "jest"],
"esModuleInterop": true,
```

### ✅ Jest Configuration
```bash
cat jest.config.js | grep -E "preset|testEnvironment|testTimeout"
```

Expected:
```javascript
preset: 'ts-jest',
testEnvironment: 'node',
testTimeout: 30000,
```

### ✅ Package Scripts
```bash
npm run | grep test
```

Expected scripts:
- `test` - Run all tests
- `test:security` - Run security tests only
- `test:watch` - Watch mode
- `test:coverage` - Coverage report

## Syntax Verification

### Test File Syntax
The test file uses correct TypeScript/Jest syntax:

✅ Import statements (CommonJS-compatible)
```typescript
import path from 'path';
import fs from 'fs/promises';
import fsSync from 'fs';
import crypto from 'crypto';
```

✅ Jest globals (no imports needed)
```typescript
describe('Test Suite', () => {
  beforeEach(async () => { /* setup */ });
  afterEach(async () => { /* cleanup */ });
  test('should do something', async () => {
    expect(value).toBe(expected);
  });
});
```

✅ Async/await patterns
```typescript
await fs.mkdir(dir);
await expect(promise).rejects.toThrow();
```

## Test Coverage Verification

### Count Tests
```bash
grep -c "^\s*test(" src/__tests__/security/attack-vectors.test.ts
```

Expected: **47**

### Test Suites
```bash
grep "describe(" src/__tests__/security/attack-vectors.test.ts
```

Expected 8 suites:
1. Security Attack Vector Prevention (root)
2. Path Traversal Attack Prevention
3. Symlink Attack Prevention
4. Command Injection Prevention
5. Resource Exhaustion Prevention
6. Security Event Logging
7. Information Disclosure Prevention
8. Edge Cases and Boundary Conditions

## Environment Setup

### Required Environment Variables
Tests automatically set:
- `WORKSPACE_BASE` → unique temp directory per test
- `LOG_DIR` → temp logs directory per test

No manual configuration needed!

### System Requirements
- Node.js 18+ (preferably 20)
- npm 9+
- Unix-like OS (some tests skip on Windows)
- `/tmp` directory writable
- `git` CLI available (for some tests)

### Permissions
```bash
# Ensure /tmp is writable
ls -ld /tmp
# Expected: drwxrwxrwt (permissions: 777 with sticky bit)

# Ensure test can create directories
touch /tmp/test-write && rm /tmp/test-write
# Should succeed without errors
```

## Common Issues Pre-Flight Check

### Issue 1: Jest Not Found
```bash
npx jest --version
```
If error: `npm install`

### Issue 2: TypeScript Errors
```bash
npx tsc --version
```
If error: TypeScript not installed (but it's in dependencies)

### Issue 3: Git Not Available
```bash
which git
```
If not found: Install git (`sudo apt-get install git` or `brew install git`)

### Issue 4: Permission Issues
```bash
mkdir /tmp/test-perms-$$
rmdir /tmp/test-perms-$$
```
Should succeed without sudo

## Dry Run Verification

### Step 1: Syntax Check (via ts-jest)
```bash
# This will fail with tsc but works with ts-jest
# Don't worry about tsc errors - Jest uses ts-jest transformer
npx jest --listTests | grep security
```

Expected output:
```
/home/frankbria/projects/claude-orchestrator/src/__tests__/security/attack-vectors.test.ts
```

### Step 2: Test Discovery
```bash
npx jest --testNamePattern="should block basic path traversal" --listTests
```

Should list the attack-vectors.test.ts file.

### Step 3: Single Test Dry Run (DON'T RUN YET - just verify command works)
```bash
# This command is ready to use (but don't run per user instructions):
# npm test -- --testNamePattern="should block basic path traversal"
echo "Command verified: npm test -- --testNamePattern='should block basic path traversal'"
```

## What to Expect When Running Tests

### Normal Test Output
```
 PASS  src/__tests__/security/attack-vectors.test.ts (12.5s)
  Security Attack Vector Prevention
    Path Traversal Attack Prevention
      ✓ should block basic path traversal (15ms)
      ✓ should block URL-encoded path traversal (8ms)
      ...
```

### Coverage Output
```
----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
----------|---------|----------|---------|---------|-------------------
All files |   87.5  |   85.2   |   88.1  |   87.3  |
----------|---------|----------|---------|---------|-------------------
```

### Test Failures (Security Vulnerability!)
```
 FAIL  src/__tests__/security/attack-vectors.test.ts
  ● Path Traversal › should block basic path traversal

    Expected function to throw error, but it succeeded

      67 |       await expect(validateWorkspacePath(maliciousPath)).rejects.toThrow();
```

**If this happens: CRITICAL SECURITY BUG - Fix immediately!**

## Performance Expectations

- **Single test**: 5-50ms
- **Test suite**: 10-15 seconds total
- **With coverage**: 15-20 seconds

If tests take > 30 seconds, check:
- Slow filesystem (running in VM/Docker?)
- Cleanup not happening (check `/tmp` size)
- Debug mode enabled

## Final Pre-Run Checklist

- [ ] Dependencies installed (`npm install`)
- [ ] Jest available (`npx jest --version`)
- [ ] TypeScript configured (`cat tsconfig.json`)
- [ ] Test file exists (`ls src/__tests__/security/attack-vectors.test.ts`)
- [ ] 47 tests counted (`grep -c "test(" ...`)
- [ ] `/tmp` writable (`touch /tmp/test && rm /tmp/test`)
- [ ] Git available (`which git`)
- [ ] Scripts configured (`npm run | grep test:security`)

## Ready to Run

Once all checks pass, you can run:

```bash
# Run all security tests
npm run test:security

# Run with coverage
npm run test:coverage -- src/__tests__/security

# Run in watch mode
npm run test:watch -- src/__tests__/security
```

## Post-Run Verification

After tests complete:

### ✅ All Tests Pass
```
Tests:       47 passed, 47 total
```

### ✅ Coverage Meets Threshold
```
Coverage:    ≥ 85% on all metrics
```

### ✅ No Leftover Artifacts
```bash
# Should be empty (or very small)
ls /tmp/security-test-* 2>/dev/null | wc -l
```

### ✅ Security Logs Created (If LOG_DIR Set)
```bash
# Tests create temp logs in their isolated directories
# These are cleaned up automatically
```

## Troubleshooting Failed Verifications

If verification fails, see:
- `README.md` - Comprehensive troubleshooting guide
- `QUICK_START.md` - Common issues section
- Test file comments - Each test has detailed documentation

---

**Verification Status**: Ready for first run ✅
**Created**: 2025-12-12
**Last Check**: Before test execution
